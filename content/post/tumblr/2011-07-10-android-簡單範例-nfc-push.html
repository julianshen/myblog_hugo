---
date: "2011-07-10T19:50:31Z"
tags:
- Android
- Mobile Dev
title: '[Android] 簡單範例: NFC Push'
tumblr_url: http://blog.jln.co/post/7452221172/android-簡單範例-nfc-push
---
<div class="posterous_autopost"><div class="p_embed p_image_embed"> <img alt="Nfc" height="245" src="http://posterous.com/getfile/files.posterous.com/temp-2011-07-10/BpmjJvxpDnJbrChvpkHltlorqJuosFsichkeqrAnwDIGprkzDcnitelkklyc/nfc.png.scaled500.png" width="306"/></div>   <p>想不出啥好idea來利用NFC, 所以呢, 身體力行勝於一切, 寫隻小範例體驗一下比較真切, 所幸Android NFC API並不難, 從研究API到寫出這個範例, 比我畫上面那張圖花的時間還更短&hellip;.</p>  <p>接收的範例已經有了<a href="http://developer.android.com/resources/samples/NFCDemo/index.html">NFC Demo</a>, 而且我比較想體驗一下P2P的狀況, 所以就寫了隻push的範例</p>  <p>這範例的功能如:</p>  <div class="p_embed p_image_embed"> <a href="http://posterous.com/getfile/files.posterous.com/temp-2011-07-10/ihpulibzHnkvjBeiAznxkrvyqJhGCchpzcIpwFFiesFkeAJyhzypaBjAAcph/idea.png.scaled1000.png"><img alt="Idea" height="297" src="http://posterous.com/getfile/files.posterous.com/temp-2011-07-10/ihpulibzHnkvjBeiAznxkrvyqJhGCchpzcIpwFFiesFkeAJyhzypaBjAAcph/idea.png.scaled500.png" width="500"/></a> </div>   <p>功能很簡單: 在Browser瀏覽網頁時按下Menu-&gt;Share page-&gt;NFC Push demo, 然後拿另一支NFC裝置來讀取分享的頁面, 因此這一頁面需要能透過NFC push去發送一個含有欲分享的URL的Message</p>  <p>首先要讓這隻程式支援NFC, 在<a href="https://github.com/julianshen/NFCPushDemo/blob/master/AndroidManifest.xml">AndroidManifest.xml</a>有三個必要的要素:</p>  <ol><li>SDK level &gt;= 10: <span style="font-family: Bitstream Vera Sans Mono, Courier, monospace; font-size: 12px; line-height: 16px;"><span class="nt" style="color: #000080; padding: 0px; margin: 0px;">&lt;uses-sdk</span> <span class="na" style="color: #008080; padding: 0px; margin: 0px;">android:minSdkVersion=</span><span class="s" style="color: #dd1144; padding: 0px; margin: 0px;">&ldquo;10&rdquo;</span> <span class="nt" style="color: #000080; padding: 0px; margin: 0px;">/&gt;</span></span></li>  <li>NFC feature : <span style="font-family: Bitstream Vera Sans Mono, Courier, monospace; font-size: 12px; line-height: 16px;"><span class="nt" style="color: #000080; padding: 0px; margin: 0px;">&lt;uses-feature</span> <span class="na" style="color: #008080; padding: 0px; margin: 0px;">android:required=</span><span class="s" style="color: #dd1144; padding: 0px; margin: 0px;">&ldquo;true&rdquo;</span> <span class="na" style="color: #008080; padding: 0px; margin: 0px;">android:name=</span><span class="s" style="color: #dd1144; padding: 0px; margin: 0px;">&ldquo;android.hardware.nfc&rdquo;</span><span class="nt" style="color: #000080; padding: 0px; margin: 0px;">&gt;&lt;/uses-feature&gt;</span></span></li>  <li>Permission for NFC: <span style="font-family: Bitstream Vera Sans Mono, Courier, monospace; font-size: 12px; line-height: 16px;"><span class="nt" style="color: #000080; padding: 0px; margin: 0px;">&lt;uses-permission</span> <span class="na" style="color: #008080; padding: 0px; margin: 0px;">android:name=</span><span class="s" style="color: #dd1144; padding: 0px; margin: 0px;">&ldquo;android.permission.NFC&rdquo;</span><span class="nt" style="color: #000080; padding: 0px; margin: 0px;">&gt;&lt;/uses-permission&gt;</span></span></li>  </ol><p>然後我們必須要一個<a href="https://github.com/julianshen/NFCPushDemo/blob/master/src/com/jlnshen/nfcpushdemo/NFCPushDemo.java">Activity</a>來支援URL的發送, 這個URL要包裝成NdefMessage</p>  <blockquote class="posterous_medium_quote">  <p><strong>NdefRecord</strong> rec = new <strong>NdefRecord</strong>(NdefRecord.<em><strong>TNF_ABSOLUTE_URI</strong></em>, NdefRecord.<em><strong>RTD_URI</strong></em>, new byte[0],share.getBytes());</p>  <p>new <strong>NdefMessage</strong>(new <strong>NdefRecord</strong>[]{rec})</p>  </blockquote>  <p>要支援push, 只需要在onResume時使用<a href="http://developer.android.com/reference/android/nfc/NfcAdapter.html#enableForegroundNdefPush(android.app.Activity,%20android.nfc.NdefMessage)">enableForegroundNdefPush</a>就可以了, onPause記得把它disable (沒disable會怎樣? 我碰到狀況是, 沒disable, 可能連之後讀取似乎都有問題) , 文件裡面是說要在main thread裡呼叫, 但試驗結果是, 也不能放在onCreate</p>  <p>Android API 網站上有<a href="http://developer.android.com/guide/topics/nfc/index.html">一篇介紹NFC的</a>, 還算蠻簡單的</p>  <p><a href="https://github.com/julianshen/NFCPushDemo"><span style="font-size: x-large;">完整的範例程式在此</span></a></p></div>
