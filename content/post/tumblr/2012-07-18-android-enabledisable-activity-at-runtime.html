---
date: "2012-07-18T01:05:39Z"
tags:
- Android
- Mobile Dev
title: '[Android] Enable/Disable Activity at runtime'
tumblr_url: http://blog.jln.co/post/27415624513/android-enabledisable-activity-at-runtime
---
<div class="posterous_autopost"><p>這篇主要來自Google I/O 2012這兩個Sessions:</p>  <p><a href="https://developers.google.com/events/io/sessions/gooio2012/101/">Making Good Apps Great: More Advanced Topics for Expert Android Developers</a></p>  <p><a href="https://developers.google.com/events/io/sessions/gooio2012/103/">Doing More With Less: Being a Good Android Citizen</a></p>  <p>在這兩堂演講中有提到, 可以利用&quot;<a href="http://developer.android.com/reference/android/content/pm/PackageManager.html#setComponentEnabledSetting%28android.content.ComponentName,%20int,%20int%29">PackageManager.setComponentEnabledSetting</a>&ldquo;把不用的Intent receiver給停用, 這在Android中的確相當有用處, 常常Intent broadcast都是一個造成系統忙碌的主要原因, 在早期的Android版本, 甚至常常碰到因&quot;android.net.conn.CONNECTIVITY_CHANGE&quot;所導致的ANR, 這是因為註冊聽這Intent的receiver常常非常的多(大多網路相關, 而智慧型手機最常見就是網路相關的軟體)</p>  <p>不過這邊要講的並不是這個問題, 不過也可以應用到同樣的技巧</p>  <p>Android中, 可以設定多個Activity去處理同一種的Intent, Share (android.intent.action.SEND)就是最典型的例子, 但這也造成另一種困擾, 註冊的應用程式太多, 導致整個Share menu相當的雜亂難選:</p>  <div class="p_embed p_image_embed"> <a href="http://getfile3.posterous.com/getfile/files.posterous.com/temp-2012-07-17/HFxpssxguCgnDwwACebnqGHiGbzCdEFqdemdkngthwmJIkviiJEvcjIysCGp/device-2012-07-18-005244.png.scaled1000.png"><img alt="Device-2012-07-18-005244" height="889" src="http://getfile4.posterous.com/getfile/files.posterous.com/temp-2012-07-17/HFxpssxguCgnDwwACebnqGHiGbzCdEFqdemdkngthwmJIkviiJEvcjIysCGp/device-2012-07-18-005244.png.scaled500.png" width="500"/></a> <a href="http://getfile9.posterous.com/getfile/files.posterous.com/temp-2012-07-17/olyCDiyjymsychmBqulibxtncpeduyEJCAurjrEDsoauBDuFypxomikyaday/device-2012-07-18-005244.png.scaled1000.png"><img alt="Device-2012-07-18-005244" height="889" src="http://getfile1.posterous.com/getfile/files.posterous.com/temp-2012-07-17/olyCDiyjymsychmBqulibxtncpeduyEJCAurjrEDsoauBDuFypxomikyaday/device-2012-07-18-005244.png.scaled500.png" width="500"/></a> <div class="p_see_full_gallery"><a href="http://julianshen.posterous.com/android-enabledisable-activity-at-runtime">See the full gallery on Posterous</a></div> </div>   <p>由這個例子看來整個list相當的長, 這對使用者來說可能不好用, 而且問題在於, 有些可能不用一開始就出現, 比如說如果沒有登入任何一個e-mail account, Mail這選項是可以被藏起來的, 這作法就是</p>  <p>ShareActivity 預設成disable:</p>  <blockquote class="posterous_short_quote">  <p>&lt;activity android:name=&quot;ShareActivity&rdquo;<strong> android:enabled=&ldquo;false&rdquo;</strong>&gt;</p>  </blockquote>  <p>這樣如果沒enable它的話, 就不會在Share list出現, 只要我們在某個點(比如說已經完成登入帳號)去enable它, 它就又可以回到這list了:</p>  <p style="padding-left: 30px;">if(pm.getComponentEnabledSetting(cname) != PackageManager.COMPONENT_ENABLED_STATE_ENABLED ) {<br/>            pm.setComponentEnabledSetting(cname, PackageManager.COMPONENT_ENABLED_STATE_ENABLED, 0);<br/>        } else {<br/>            pm.setComponentEnabledSetting(cname, PackageManager.COMPONENT_ENABLED_STATE_DISABLED, 0);<br/>        }</p></div>
