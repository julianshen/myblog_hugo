---
date: "2013-06-29T08:31:32Z"
tags:
- IFTTT
- Blogger
- android
- android development
title: '[Android] Retrofit + Signpost :  替Retrofit加上OAuth支援'
tumblr_url: http://blog.jln.co/post/54139895920/android-retrofit-signpost
---
看到Square發表的這個Retrofit - <a href="http://bit.ly/167v72a">http://bit.ly/167v72a</a> 蠻有趣的, 它的目的似乎是試圖的想要去簡化開發REST client, 開發者不用寫太多的邏輯, 只要寫一個Interface跟利用annotation就可以完成一個簡單的REST client:<br/><br/><pre class="prettyprint prettyprinted" style="background-color: whitesmoke; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; border-top-left-radius: 4px; border-top-right-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902); color: #666666; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 13px; line-height: 20px; margin-bottom: 20px; padding: 9.5px; white-space: pre-wrap; word-break: break-all; word-wrap: break-word;"><span class="kwd">public</span><span class="pln" style="color: black;"> </span><span class="kwd">interface</span><span class="pln" style="color: black;"> </span><span class="typ" style="color: #222222;">GitHubService</span><span class="pln" style="color: black;"> </span><span class="pun" style="color: #888888;">{</span><span class="pln" style="color: black;"><br/></span><span class="lit">@GET</span><span class="pun" style="color: #888888;">(</span><span class="str" style="color: #32835b;">"/users/{user}/repos"</span><span class="pun" style="color: #888888;">)</span><span class="pln" style="color: black;"><br/></span><span class="typ" style="color: #222222;">List</span><span class="pun" style="color: #888888;">&lt;</span><span class="typ" style="color: #222222;">Repo</span><span class="pun" style="color: #888888;">&gt;</span><span class="pln" style="color: black;"> listRepos</span><span class="pun" style="color: #888888;">(</span><span class="lit">@Path</span><span class="pun" style="color: #888888;">(</span><span class="str" style="color: #32835b;">"user"</span><span class="pun" style="color: #888888;">)</span><span class="pln" style="color: black;"> </span><span class="typ" style="color: #222222;">String</span><span class="pln" style="color: black;"> user</span><span class="pun" style="color: #888888;">);</span><span class="pln" style="color: black;"><br/></span><span class="pun" style="color: #888888;">}</span></pre><div><span class="pun" style="color: #888888;"><br/></span></div>因為開發者只需要寫interface和annotation, 實質上並不用寫任何的code, 真正實作的部份他用了Proxy class的技巧包裝起來了, 這作法讓我想起來很久之前我在之前的工作幫公司寫的一個legacy系統的wrapper, 那時有很多機器產生的interface, 如果人工一個個實作很浪費時間, Proxy class可以解決掉這一部分的問題, 同樣的在retrofit似乎也是想用這技巧節省實作<br/><br/>但可惜的是, 現在的retrofit並還沒加入OAuth的支援, 因此送出去的API部分並沒被oauth簽章過,不過所幸要解決這一部分也不難, 寫一個Client class搭配<a href="http://bit.ly/11OBeF8" target="_blank">Signpost</a>還是可以做到, 這邊範例繼承了OkClient(使用OkHttp) :<br/><br/><br/><script src="http://bit.ly/14BPkrJ"></script><br/>因為OkHttp也是一種HttpURLConnection, 因此Signpost搭配DefaultOAuthProvider和DefaultOAuthConsumer即可, 另外初始化RestAdapter時加上這個新的Client即可:<br/><br/><blockquote class="tr_bq">RestAdapter restAdapter = new RestAdapter.Builder()                         .setClient(new SignedOkClient(mConsumer)) </blockquote><br/><br/>
via Blogger <a href="http://bit.ly/11OBeFb">http://bit.ly/11OBeFb</a>
