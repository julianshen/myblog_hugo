---
date: "2010-12-08T22:45:42Z"
tags:
- Python
- Web Dev
title: '[筆記] 產生 Web page thumbnail (續前篇)'
tumblr_url: http://blog.jln.co/post/2143564780/筆記-產生-web-page-thumbnail-續前篇
---
<div class="posterous_autopost"><p>在<a href="http://julianshen.posterous.com/-web-page-thumbnail">前篇提到利用CutyCapt來產生Web page thumbnail</a>, 不過畢竟CutyCapt是C++寫的, build出來也是一個執行檔, 寫完上一篇就有股衝動想用<a href="http://www.riverbankcomputing.co.uk/news">PyQt</a>來做, 反正一樣可以利用Qt/WebKit, 原理應該相同的</p>  <p>沒想到, 真的那麼簡單, 只用了二十幾行code就可以辦到了</p>  <p>這邊主要利用到的一個class就是 <a href="http://www.riverbankcomputing.co.uk/static/Docs/PyQt4/html/qwebpage.html">QWebPage</a> , 透過這個class我們就可以很簡單的達成這任務</p>  <p>為了程式的重複利用性, 我把它包裝成一個class PageRender:</p>  <blockquote>  <p>class PageRender(QObject):</p>  <p>    def __init__(self, url, outfile, scale):</p>  <p>       QObject.__init__(self)</p>  <p>       self.outfile = outfile</p>  <p>       self.scale = scale</p>  <p>       self.web = QWebPage()</p>  <p>       self.web.mainFrame().load(QUrl(url))</p>  <p>       self.connect(self.web, SIGNAL(&ldquo;loadFinished(bool)&rdquo;) ,self.loadFinished)</p>    <p>    def loadFinished(self, b):</p>  <p>        print &ldquo;load finished&rdquo;</p>  <p>        self.web.setViewportSize(self.web.mainFrame().contentsSize())</p>  <p>        image = QImage(self.web.viewportSize(), QImage.Format_ARGB32);</p>  <p>        painter = QPainter(image)</p>  <p>        self.web.mainFrame().render(painter)</p>  <p>        painter.end()</p>  <p>        thumbnail = image.scaledToWidth(self.scale)</p>  <p>        thumbnail.save(self.outfile)</p>  <p>        app.exit(0)</p>    </blockquote>  <p> 在Constructor那邊做的就是把loadFinished跟我們實際處理save to thumbnail的function connect在一起</p>  <p>而在loadFinished那邊就是實際render到image的部份, 這邊要注意的是:</p>  <blockquote class="posterous_short_quote">  <p>self.web.setViewportSize(self.web.mainFrame().contentsSize())</p>  </blockquote>  <p>這是把QWebPage的View port size設成跟實際content一樣大, 後面接著我們就可以建立QImage跟其相對映的painter, 然後用QWebFrame的&quot;render()&ldquo;把它實際輸出到image</p>  <p>最後scale到我們想要的大小(pixels)</p>  <p>這邊是一個實際call它的範例:</p>  <blockquote class="posterous_short_quote">  <p>p = PageRender(&quot;http://www.yahoo.com.tw&rdquo;, &ldquo;sssss.png&rdquo;, 200)</p>  </blockquote>  <p>結果:</p>  <p><img src="http://posterous.com/getfile/files.posterous.com/temp-2010-12-08/peiueoGCpEqHokvqDIdzrIcEqJprdsgdsAuIloHtFwykfnDGudcfynDtBhGG/sssss.png.scaled500.png" width="200" height="357"/> 實際的程式可以<a href="https://bitbucket.org/fishuman/webcutter/src">在此下載</a></p></div>
