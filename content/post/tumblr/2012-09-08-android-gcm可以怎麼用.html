---
date: "2012-09-08T00:21:43Z"
tags:
- IFTTT
- Blogger
title: '[Android] GCM可以怎麼用?'
tumblr_url: http://blog.jln.co/post/31061478807/android-gcm可以怎麼用
---
GCM的前身就是所謂的C2DM, 最早在今年Google I/O時聽到C2DM將進化到GCM時, 就在想, 一定要架個server才可以利用GCM嗎?<br/><br/>其實是可以不用的<br/><br/><div class="separator" style="clear: both; text-align: center;"><a href="http://bit.ly/Ngg8t2" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="104" src="http://bit.ly/Q9qUPv" width="320"/></a></div>從API console可知, 是可以設定允許從任意IP傳送的<br/><br/>再來看看一般的流程:<br/>1. Regster:<br/><blockquote class="tr_bq"><pre class="prettyprint pretty-java"><span class="typ">GCMRegistrar</span><span class="pun">.</span><span class="pln">checkDevice</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span><span class="pln"><br/></span><span class="typ">GCMRegistrar</span><span class="pun">.</span><span class="pln">checkManifest</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span><span class="pln"><br/></span><span class="kwd">final</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> regId </span><span class="pun">=</span><span class="pln"> </span><b><span class="typ">GCMRegistrar</span><span class="pun">.</span><span class="pln">getRegistrationId</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span></b><span class="pln"><br/></span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">regId</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="str">""</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br/></span><span class="typ">GCMRegistrar</span><span class="pun">.</span><span class="kwd">register</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> SENDER_ID</span><span class="pun">);</span><span class="pln"><br/></span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br/></span><span class="typ">Log</span><span class="pun">.</span><span class="pln">v</span><span class="pun">(</span><span class="pln">TAG</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Already registered"</span><span class="pun">);</span><span class="pln"><br/></span><span class="pun">}</span></pre></blockquote>2. 取得Registration ID後將ID送至Server <br/>3. Server之後可以用這ID送訊息給這一支手機<br/><br/>由&quot;2&quot;看來, 其實Registration ID是關鍵, 而不是Server, 任何人只要有Registration ID, 就可以傳送訊息給這隻手機了<br/><br/>做了個小小實驗, 寫了一支Activity同時具備了收訊息以及傳送(給自己)的能力:<br/><a href="http://bit.ly/Nggb8b"><br/></a><a href="http://bit.ly/Q9qSag">http://bit.ly/Q9qSag</a><br/><br/>想到的應用: 兩隻手機透過條碼或藍牙交換Registration ID, 就可以透過GCM互傳訊息了<br/><br/>缺點: Registration ID如果有變(GCM是有可能更換ID), 就失效了<br/><br/>
via Blogger <a href="http://bit.ly/Q9qSai">http://bit.ly/Q9qSai</a>
